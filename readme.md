# О сборке
Сборка Docker для разработки нескольких приложений с использованием Linux, Apache, PostgreSQL и PHP.

Струкура:  
__apache2/apache2.conf__  - _файл конфигурации веб-сервера apache_;  
__apache2/site-available__  - _файлы конфигурации вприложений_;  
__postgres/docker-entrypoint-initdb.d/__  - _том контейнера db_;  
__.env__ - файл с информацией о приложениях и БД.

# Использование
Собрать контейнеры:
```
docker-compose up
```
Чтобы полностью пересобрать контейнеры:
```
docker-compose up -d --no-deps --build
```

Работа в CLI __php-apache__ и __postgres__:
```
docker-compose exec web bash
docker-compose exec db bash
```

## Приложения
По умолчанию в сборке  одно приложение app. Чтобы добавить еще одно приложение необходимо выполнить несколько действий:
1. Указать в файле _.env_ название приложения и путь к файлам проекта. Для приложения __app__ - это переменные *APP_NAME* и *APP_SRC*;
2. В файле _docker-compose.yaml_ добавить описание тома для контейнера _web_;
3. Добавить файл конфигурации приложения. Важно, чтобы директива _DocumentRoot_ в этом файле совпадала с правой частью описания тома этого приложения, т.е. правильно указывала на расположения файлов приложения;
4. Отредактировать файл _hosts_ ОС хост-машины.
5. _(Дополнительно)_ Для нового приложения необходимо вручную создать базу данных. Для этого необходимо воспользоваться CLI PostgeSQL внутри контейнера db. Если на данном этапе не создано ни одной базы данных, то можно указать для переменной **POSTGRES_DATABASES** в файле _.env_ имена баз данных, которые необходимо создать и они будут добавлены автоматически при сборке контейнеров, а их пользователем будет назначет **POSTGRES_USER**.

Для работы с базами данных используется один суперпользователь. Его имя **POSTGRES_USER** и пароль **POSTGRES_PASSWORD** указаны в файле _.env_. 

# Для Laravel
## Подготовка к разработке
1. В каталог приложения (указан в файле __.env) скопировать шаблон приложения Laravel:
```
git clone https://github.com/laravel/laravel.git
```

2. Файл _.env.example_ переименовать в _.env_;

3. Для работы с базой данных необходимо указать в .env файле параметры подключения к ней:
``` 
DB_CONNECTION=pgsql
DB_HOST=db           (название контейнера БД)
DB_PORT=5432         (порт в контейнере БД)
DB_DATABASE=db_name  (название БД)
DB_USERNAME=username (имя пользователя)
DB_PASSWORD=password (пароль)
```

4. Чтобы выполнить установку composer и подготовить прилоджение к разработке, нужно выполнить в CLI ОС контейнера web следующие команды:
```
composer install

php artisan config:cache
php artisan key:generate
php artisan migrate
```